<?xml version="1.0" encoding="UTF-8"?>

<process name="TrainStationDecisions"  xmlns="urn:jbpm.org:jpdl-3.2">

	<start-state>
		<transition to="welcome" />
	</start-state>

	<state name="welcome">

		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Welcome to train station scheduler service. Press following digits for 1) Train schedule.  2) Station location. 3) Discount rates. 4) Promo</prompt>
       		</action>
      	</event>
 
		<transition name="welcome" to="welcome_decision" />

	</state>

	<decision name="welcome_decision" expr="#{ussd.input}">
		<handler class="org.mobicents.example.ss7.ussd.jbpm.USSDDecisionHandler" />
		
		<transition name="1" to="schedule" />
		<transition name="2" to="location" />
		<transition name="3" to="discount" />
		<transition name="4" to="promo" />
		<!-- this is default transition to end, it has to be present -->	
		<transition name="end" to="end" />	
		
	</decision>
	<!-- SCHEDULE -->
	<state name="schedule">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Please pick city 1) Pune.  2) Test location. 3) Volgograd. 4) End</prompt>
       		</action>
      	</event>
		<transition name="decide" to="schedule_decision" />
	</state>

	
	<decision name="schedule_decision" expr="#{ussd.input}">
		<handler class="org.mobicents.example.ss7.ussd.jbpm.USSDDecisionHandler" />
		
		<transition name="1" to="schedule_pune" />
		<transition name="2" to="schedule_test" />
		<transition name="3" to="schedule_volgograd" />
		<transition name="4" to="end" />
		<!-- this is default transition to end, it has to be present -->	
		<transition name="end" to="end" />	
	</decision>
	
	<state name="schedule_pune">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Trains leave to each destination on each odd hour.</prompt>
       			<end>true</end>
       		</action>
      	</event>
		<transition name="end" to="end" />
	</state>>
	<state name="schedule_test">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Test location does not have any means of transport!</prompt>
       			<end>true</end>
       		</action>
      	</event>
		<transition name="end" to="end" />
	</state>
	<state name="schedule_volgograd">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Test location does not have any means of transport!</prompt>
       			<end>true</end>
       		</action>
      	</event>
		<transition name="end" to="end" />
	</state>
	
	<!-- LOCATION -->
	<state name="location">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Please pick city 1) Pune.  2) Test location. 3) Volgograd. 4) End</prompt>
       		</action>
      	</event>
		<transition name="decide" to="location_decision" />
	</state>

	
	<decision name="location_decision" expr="#{ussd.input}">
		<handler class="org.mobicents.example.ss7.ussd.jbpm.USSDDecisionHandler" />
		
		<transition name="1" to="location_pune" />
		<transition name="2" to="location_test" />
		<transition name="3" to="location_volgograd" />
		<transition name="4" to="end" />	
		<!-- this is default transition to end, it has to be present -->	
		<transition name="end" to="end" />	
	</decision>
	
	<state name="location_pune">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Train station is located at 353, Laxmi Road, Near Vijay Talkies .</prompt>
       			<end>true</end>
       		</action>
      	</event>
		<transition name="end" to="end" />
	</state>
	<state name="location_test">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Test location does not have any means of transport!</prompt>
       			<end>true</end>
       		</action>
      	</event>
		<transition name="end" to="end" />
	</state>
	<state name="location_volgograd">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>Train stations are located at: улица Козловская, 48, г. Волгоград, Волгоградская обл., Russia 400039 and Коммунистическая улица, 19, д, г. Волгоград, Волгоградская обл., Russia 400131</prompt>
       			<end>true</end>
       		</action>
      	</event>
		<transition name="end" to="end" />
	</state>
	<!-- DISCOUNT -->
	<state name="discount">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>There are no DISCOUNT! Pay the price!</prompt>
       			<end>true</end>
       		</action>
      	</event>
		<transition name="end" to="end" />
	</state>
	<!-- PROMO -->
	<state name="promo">
	
		<event type='node-enter'>
       		<action class='org.mobicents.example.ss7.ussd.jbpm.USSDPromptHandler'>
       			<prompt>You are now trapped in endles loop! Press something!</prompt>
       			<end>true</end>
       		</action>
      	</event>
		<transition name="decide" to="discount_decision" />
	</state>
	<decision name="discount_decision" expr="#{ussd.input}">
		<handler class="org.mobicents.example.ss7.ussd.jbpm.USSDDecisionHandler" />
		
		<transition name="0" to="end" />
		<transition name="end" to="discount" />	
		
	</decision>
	
	
	<end-state name="end" />

</process>
